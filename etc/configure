#!/bin/bash

PROJ=`pipenv --where`

# Write environment variables to .env
echo PYTHONPATH=${PROJ} >> .env
echo IPYTHONDIR=${PROJ}/.ipython >> .env
echo MATPLOTLIBRC=${PROJ}/.matplotlib >> .env
echo MPLCONFIGDIR=${PROJ}/.matplotlib >> .env
export $(grep -v '^#' .env | xargs)

# Create IPython profile
mkdir -p ${IPYTHONDIR}
ipython profile create default --ipython-dir ${IPYTHONDIR}

# Create Jupyter kernel
ipython kernel install --sys-prefix --profile default --display-name Default

# Create IPython startup
cat << EOS > ${IPYTHONDIR}/profile_default/startup/00.py
import re
import os
import sys
import time
from pathlib import Path
from datetime import datetime

import decode as dc
import numpy as np
import xarray as xr
import matplotlib.pyplot as plt
EOS

# Create empty matplotlibrc and stylelib directory
mkdir -p ${MATPLOTLIBRC}
mkdir -p ${MPLCONFIGDIR}/stylelib
touch ${MATPLOTLIBRC}/matplotlibrc